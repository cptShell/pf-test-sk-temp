# üß© –ú–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ Vite + Module Federation

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä –º–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã: shell-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (host) –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–∑ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö remote-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ Module Federation.

## –ß—Ç–æ —ç—Ç–æ —Ä–µ—à–∞–µ—Ç?

**–ü—Ä–æ–±–ª–µ–º—ã –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:**

- ‚ùå –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–µ–ø–ª–æ–π –¥—Ä—É–≥–æ–π
- ‚ùå –û–≥—Ä–æ–º–Ω—ã–π bundle, –¥–æ–ª–≥–∞—è —Å–±–æ—Ä–∫–∞
- ‚ùå –°–ª–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã
- ‚ùå –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –ª–æ–º–∞—é—Ç –≤—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–ß—Ç–æ –¥–∞—ë—Ç –º–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:**

- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –¥–µ–ø–ª–æ–π –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- ‚úÖ –ú–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏ –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –≤—Å–µ–≥–æ
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è –∫–æ–¥–∞ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   host (shell)  ‚îÇ  ‚Üê Shell-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Ä–æ—É—Ç–∏–Ω–≥–æ–º
‚îÇ  React Router   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  todo-remote    ‚îÇ  ‚Üê –ú–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç —Å Todo-–ª–æ–≥–∏–∫–æ–π
‚îÇ  Zustand store  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    ui-kit       ‚îÇ  ‚Üê –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ  TextInput,     ‚îÇ
‚îÇ  TodoItem       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–¢—Ä–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞:**

1. **`host/`** ‚Äî shell-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —Ç–æ–ª—å–∫–æ —Ä–æ—É—Ç–∏–Ω–≥ –∏ –∫–∞—Ä–∫–∞—Å
2. **`todo-remote/`** ‚Äî Todo-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç
3. **`ui-kit/`** ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (TextInput, TodoItem)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 20.9+ (`nvm use 20.9`)
- npm

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ï—Å—Ç—å —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å—é —Ü–µ–ø–æ—á–∫—É:

```bash
./dev-chain.sh
```

–°–∫—Ä–∏–ø—Ç:

1. –°–æ–±–∏—Ä–∞–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç `ui-kit` –Ω–∞ –ø–æ—Ä—Ç—É 4174
2. –°–æ–±–∏—Ä–∞–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç `todo-remote` –Ω–∞ –ø–æ—Ä—Ç—É 4175
3. –ó–∞–ø—É—Å–∫–∞–µ—Ç `host` –≤ dev-—Ä–µ–∂–∏–º–µ –Ω–∞ –ø–æ—Ä—Ç—É 4173

–û—Ç–∫—Ä–æ–π `http://localhost:4173/todo` ‚Äî —É–≤–∏–¥–∏—à—å Todo-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –º–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç.

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏:

**1. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**

```bash
cd ui-kit && npm install
cd ../todo-remote && npm install
cd ../host && npm install
```

**2. –ó–∞–ø—É—Å—Ç–∏ ui-kit (remote-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞):**

```bash
cd ui-kit
npm run build
npm run preview -- --port 4174
```

–ü—Ä–æ–≤–µ—Ä—å: `http://localhost:4174/assets/remoteEntry.js` –¥–æ–ª–∂–µ–Ω –æ—Ç–¥–∞–≤–∞—Ç—å JS-—Ñ–∞–π–ª.

**3. –ó–∞–ø—É—Å—Ç–∏ todo-remote (–º–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç):**

```bash
cd todo-remote
npm run dev -- --port 4175
```

**4. –ó–∞–ø—É—Å—Ç–∏ host (shell):**

```bash
cd host
npm run dev
```

–û—Ç–∫—Ä–æ–π `http://localhost:4173` ‚Üí –ø–µ—Ä–µ–π–¥–∏ –Ω–∞ `/todo` ‚Üí —É–≤–∏–¥–∏—à—å Todo-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### Module Federation

**Module Federation** –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–¥–Ω–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é (host) –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –º–æ–¥—É–ª–∏ –∏–∑ –¥—Ä—É–≥–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (remote) –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

**–í –∫–æ–¥–µ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:**

```tsx
// host/src/App.tsx
const TodoRemote = lazy(() => import("todo_remote/TodoApp"));

// todo-remote/src/App.tsx
const TextInput = lazy(() => import("ui-kit/TextInput"));
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. Host –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ `todo-remote` –∑–∞ `remoteEntry.js`
2. `remoteEntry.js` —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞–Ω–∏—Ñ–µ—Å—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –º–æ–¥—É–ª–µ–π
3. Host –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç `TodoApp` –∏–∑ remote
4. `TodoApp` –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ `ui-kit`

### Shared Dependencies

React, ReactDOM –∏ Zustand –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `shared` —Å `singleton: true`, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤ bundle:

```ts
shared: {
  react: { singleton: true, eager: true },
  'react-dom': { singleton: true, eager: true },
  zustand: { singleton: true, eager: true }
}
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ host/              # Shell-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ App.tsx    # –†–æ—É—Ç–∏–Ω–≥ + lazy-–∑–∞–≥—Ä—É–∑–∫–∞ todo-remote
‚îÇ   ‚îî‚îÄ‚îÄ vite.config.ts # Module Federation: remotes
‚îÇ
‚îú‚îÄ‚îÄ todo-remote/       # –ú–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç —Å Todo-–ª–æ–≥–∏–∫–æ–π
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.tsx    # TodoApp –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ store.ts   # Zustand store
‚îÇ   ‚îî‚îÄ‚îÄ vite.config.ts # Module Federation: remotes + exposes
‚îÇ
‚îî‚îÄ‚îÄ ui-kit/            # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    ‚îú‚îÄ‚îÄ src/
    ‚îÇ   ‚îî‚îÄ‚îÄ components/
    ‚îÇ       ‚îú‚îÄ‚îÄ TextInput.tsx
    ‚îÇ       ‚îî‚îÄ‚îÄ TodoItem.tsx
    ‚îî‚îÄ‚îÄ vite.config.ts # Module Federation: exposes
```

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Vite** ‚Äî —Å–±–æ—Ä—â–∏–∫
- **@originjs/vite-plugin-federation** ‚Äî Module Federation –¥–ª—è Vite
- **React 18** ‚Äî UI –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- **React Router 6** ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
- **Zustand** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- **TypeScript** ‚Äî —Ç–∏–ø–∏–∑–∞—Ü–∏—è

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### –ü–æ—á–µ–º—É `npm run preview` –¥–ª—è remotes?

–í dev-—Ä–µ–∂–∏–º–µ (`npm run dev`) Vite –Ω–µ —Å–æ–∑–¥–∞—ë—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π `remoteEntry.js` –Ω–∞ –¥–∏—Å–∫–µ ‚Äî –æ–Ω –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π. –î—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ –º–æ–≥—É—Ç –µ–≥–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ HTTP.

–†–µ—à–µ–Ω–∏–µ: –∑–∞–ø—É—Å–∫–∞—Ç—å remotes —á–µ—Ä–µ–∑ `npm run build && npm run preview`, —á—Ç–æ–±—ã `remoteEntry.js` –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ —Ä–µ–∞–ª—å–Ω–æ–º—É URL.

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–ª—è production —É–∫–∞–∂–∏ URL remote-–º–æ–¥—É–ª–µ–π:

**host/.env.production:**

```bash
VITE_TODO_REMOTE_URL=https://todo-remote.example.com/assets/remoteEntry.js
```

**todo-remote/.env.production:**

```bash
VITE_UI_KIT_URL=https://ui-kit.example.com/assets/remoteEntry.js
```

### –ü–æ—Ä—Ç—ã

- `4173` ‚Äî host (shell)
- `4174` ‚Äî ui-kit (remote-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞)
- `4175` ‚Äî todo-remote (–º–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç)

## Production —Å–±–æ—Ä–∫–∞

```bash
# 1. –°–æ–±–µ—Ä–∏ ui-kit
cd ui-kit
npm run build
# –ó–∞–¥–µ–ø–ª–æ–π dist/ –Ω–∞ CDN/—Å–µ—Ä–≤–µ—Ä

# 2. –°–æ–±–µ—Ä–∏ todo-remote (—É–∫–∞–∂–∏ VITE_UI_KIT_URL)
cd ../todo-remote
npm run build
# –ó–∞–¥–µ–ø–ª–æ–π dist/ –Ω–∞ CDN/—Å–µ—Ä–≤–µ—Ä

# 3. –°–æ–±–µ—Ä–∏ host (—É–∫–∞–∂–∏ VITE_TODO_REMOTE_URL)
cd ../host
npm run build
# –ó–∞–¥–µ–ø–ª–æ–π dist/ –Ω–∞ CDN/—Å–µ—Ä–≤–µ—Ä
```

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

- –î–æ–±–∞–≤—å –±–æ–ª—å—à–µ remote-—Å—Ç—Ä–∞–Ω–∏—Ü (–ø—Ä–æ—Ñ–∏–ª—å, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
- –ù–∞—Å—Ç—Ä–æ–π –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ remote-–º–æ–¥—É–ª–µ–π
- –î–æ–±–∞–≤—å fallback UI –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ remote
- –ù–∞—Å—Ç—Ä–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≥—Ä—É–∑–∫–∏ remote-–º–æ–¥—É–ª–µ–π
- –ò—Å–ø–æ–ª—å–∑—É–π CDN –¥–ª—è remote-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Module Federation](https://module-federation.github.io/)
- [@originjs/vite-plugin-federation](https://github.com/originjs/vite-plugin-federation)
- [Vite](https://vitejs.dev/)
